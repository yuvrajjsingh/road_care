<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Citizen Road Feedback</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


  <style>
    body {
      background: linear-gradient(135deg, #0072ff, #00c6ff);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    .btn-primary {
      border-radius: 30px;
      font-weight: bold;
    }
    h2 {
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  
  <div class="container">
    <div class="card p-5">
      <h2 class="text-center mb-4"><i class="bi bi-cone-striped text-warning"></i> Road Maintenance Feedback</h2>
      <!-- OpenStreetMap Map -->
      <div id="map" style="height: 400px; margin-bottom: 30px; border-radius: 12px;"></div>
      <form action="{{url_for('submit')}}" method="post" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">Your Name</label>
          <input type="text" name="name" class="form-control" placeholder="Enter your name" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Location</label>
          <input type="text" name="location" class="form-control" placeholder="Street / Area" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Issue Type</label>
          <select name="issue" class="form-select">
            <option>Pothole</option>
            <option>Street Light</option>
            <option>Garbage</option>
            <option>Road Crack</option>
            <option>Flooding</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Severity</label>
          <select name="severity" class="form-select">
            <option>Low</option>
            <option>Medium</option>
            <option>High</option>
            <option>Critical</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Select Authority</label>
          <select name="authority" class="form-select" id="authority-select" required>
            <option value="PWD">PWD</option>
            <option value="LDA">LDA</option>
            <option value="Nagar Nigam">Nagar Nigam</option>
            <option value="Municipality">Municipality</option>
            <option value="Urban development">Urban development</option>
            
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Authority Email</label>
          <input type="text" id="authority-email" class="form-control" value="pwd@example.com" readonly>
        </div>
        <div class="mb-3">
          <label class="form-label">Upload Photo (optional)</label>
          <input type="file" name="photo" class="form-control">
        </div>
        <div class="mb-3">
          <label class="form-label">Additional Comments</label>
          <textarea name="comments" class="form-control" rows="3"></textarea>
        </div>

        <button type="submit" class="btn btn-primary w-100 py-2">Submit Feedback</button>
         
      </form>

      <div class="mt-3 text-center">
        <a href="{{url_for('reports')}}" class="btn btn-secondary">view your report</a>
      </div>

      
    </div>
  </div>



  <script>
    // Authority email mapping
    const authorityEmails = {
      "PWD": "pwd@gov.com",
      "LDA": "lda@gov.com",
      "Nagar Nigam": "nagarnigam@gov.com",
      "Municipality": "municipality@gov.com",
      "Urban development": "urbandev@gov.com"
      
    };
    document.getElementById('authority-select').addEventListener('change', function() {
      const selected = this.value;
      document.getElementById('authority-email').value = authorityEmails[selected];
    });
    // Initialize Leaflet map
    var map = L.map('map').setView([28.6139, 77.2090], 13); // Example: Delhi coordinates
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    var marker;
    map.on('click', function(e) {
      var lat = e.latlng.lat;
      var lng = e.latlng.lng;

      // Remove previous marker
      if (marker) {
        map.removeLayer(marker);
      }
      marker = L.marker([lat, lng]).addTo(map);

      // Reverse geocoding using Nominatim
      fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lng}`)
        .then(response => response.json())
        .then(data => {
          var address = data.display_name || `${lat}, ${lng}`;
          document.querySelector('input[name="location"]').value = address;
        })
        .catch(() => {
          document.querySelector('input[name="location"]').value = `${lat}, ${lng}`;
        });
    });
  </script>
</body>
</html>